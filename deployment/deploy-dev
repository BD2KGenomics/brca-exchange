#!/bin/bash

echo PATH $PATH
HOST=brcaexchange-deployment1721.cloudapp.net
USER=brca

# directory of this file
DEPLOYMENT="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
WEBSITE=${DEPLOYMENT}/../website

# Drop in site settings.
# XXX add secure config
cp ${DEPLOYMENT}/site_settings/site_settings.beta.py ${WEBSITE}/django/brca/site_settings.py

cd ${WEBSITE}
npm run build:prod

# deploy
rsync -a --delete --rsync-path='sudo rsync' build/ ${USER}@${HOST}:/var/www/html/production
rsync -a --delete --rsync-path='sudo rsync' django/ ${USER}@${HOST}:/var/www/backend/production/django
